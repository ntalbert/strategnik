---
import BaseLayout from './BaseLayout.astro';
import NewsletterForm from '../components/NewsletterForm.astro';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    date: Date;
    category: string;
    featured?: boolean;
    image?: string;
  };
}

const { frontmatter } = Astro.props;

const categoryLabels: Record<string, string> = {
  'field-notes': 'Field Notes',
  'case-study': 'Case Study',
  'playbook': 'Playbook',
  'physics': 'Physics of Marketing',
};

const formattedDate = frontmatter.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
  <article class="section">
    <div class="container-narrow">
      <!-- Back link -->
      <a
        href="/writing"
        class="inline-flex items-center text-sm text-gray-400 hover:text-white transition-colors mb-8 group"
      >
        <span class="mr-2 group-hover:-translate-x-1 transition-transform">←</span>
        Back to Writing
      </a>

      <!-- Header -->
      <header class="mb-12">
        <div class="flex items-center gap-4 mb-6">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-800 text-gray-300 border border-gray-700">
            {categoryLabels[frontmatter.category] || frontmatter.category}
          </span>
          <time class="text-sm text-gray-500" datetime={frontmatter.date.toISOString()}>
            {formattedDate}
          </time>
        </div>
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight mb-6 text-white">{frontmatter.title}</h1>
        <p class="text-xl text-gray-400 max-w-prose">{frontmatter.description}</p>
      </header>

      <!-- Header Image -->
      {frontmatter.image && (
        <div class="mb-12 -mx-4 md:-mx-8 lg:-mx-16">
          <img
            src={frontmatter.image}
            alt={frontmatter.title}
            class="w-full h-auto rounded-lg"
          />
        </div>
      )}

      <!-- Content -->
      <div class="prose prose-invert prose-lg max-w-none">
        <slot />
      </div>

      <!-- Author Bio -->
      <div class="mt-12 pt-8 border-t border-gray-800">
        <p class="text-gray-400 italic">
          Nick Talbert builds marketing infrastructure for technical products. 20+ years in B2B SaaS, adtech, and enterprise technology.
          <a href="https://www.linkedin.com/in/nick-talbert/" target="_blank" rel="noopener noreferrer" class="text-teal-400 hover:text-white transition-colors">LinkedIn</a> |
          <a href="mailto:nick@strategnik.com" class="text-teal-400 hover:text-white transition-colors">nick@strategnik.com</a>
        </p>
      </div>

      <!-- Share / Footer -->
      <footer class="mt-8 pt-8 border-t border-gray-800">
        <div class="flex items-center justify-between">
          <a
            href="/writing"
            class="inline-flex items-center text-sm text-gray-400 hover:text-white transition-colors group"
          >
            <span class="mr-2 group-hover:-translate-x-1 transition-transform">←</span>
            More Writing
          </a>
          <div class="flex items-center gap-4">
            <span class="text-sm text-gray-500">Share:</span>
            <a
              href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(frontmatter.title)}&url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Share on Twitter"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
            </a>
            <a
              href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
              target="_blank"
              rel="noopener noreferrer"
              class="text-gray-400 hover:text-white transition-colors"
              aria-label="Share on LinkedIn"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
              </svg>
            </a>
          </div>
        </div>
      </footer>
    </div>
  </article>

  <!-- Newsletter CTA -->
  <NewsletterForm
    variant="default"
    heading="Enjoyed this post?"
    description="Get new articles delivered to your inbox. No spam, just thinking about demand generation and B2B SaaS growth."
  />
</BaseLayout>

<style is:global>
  .prose {
    --tw-prose-body: #d1d5db;
    --tw-prose-headings: #fff;
    --tw-prose-links: #5eead4;
    --tw-prose-bold: #fff;
    --tw-prose-code: #fff;
    --tw-prose-quotes: #b8b8b8;
    --tw-prose-quote-borders: #4b5563;
    --tw-prose-hr: #4b5563;
  }

  .prose a {
    color: #5eead4;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose a:hover {
    color: #fff;
  }

  .prose h2 {
    margin-top: 3rem;
    margin-bottom: 1.25rem;
    font-size: 1.875rem;
    font-weight: 700;
    color: #fff;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #374151;
  }

  .prose h3 {
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-size: 1.35rem;
    font-weight: 700;
    color: #fff;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #374151;
  }

  .prose p {
    margin-bottom: 1.5rem;
    line-height: 1.75;
  }

  .prose ul,
  .prose ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
  }

  .prose blockquote {
    border-left: 4px solid #374151;
    padding-left: 1.5rem;
    font-style: italic;
    color: #9ca3af;
  }

  .prose code {
    background: #1f2937;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }

  .prose pre {
    background: #1f2937;
    padding: 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1.5rem;
  }

  .prose pre code {
    background: transparent;
    padding: 0;
  }

  .prose img {
    border-radius: 0.5rem;
    margin: 2rem 0;
  }

  .prose hr {
    border-color: #374151;
    margin: 3rem 0;
  }

  /* Table Styling */
  .prose table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    font-size: 0.9rem;
    border: 1px solid #374151;
    border-radius: 0.5rem;
    overflow: hidden;
  }

  .prose thead {
    background: #1f2937;
  }

  .prose th {
    padding: 0.875rem 1rem;
    text-align: left;
    font-weight: 600;
    color: #fff;
    border-bottom: 2px solid #4b5563;
    border-right: 1px solid #374151;
  }

  .prose th:last-child {
    border-right: none;
  }

  .prose td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #374151;
    border-right: 1px solid #374151;
    color: #d1d5db;
  }

  .prose td:last-child {
    border-right: none;
  }

  .prose tbody tr:nth-child(odd) {
    background: #111827;
  }

  .prose tbody tr:nth-child(even) {
    background: #1a1f2e;
  }

  .prose tbody tr:hover {
    background: #252d3d;
  }

  .prose tbody tr:last-child td {
    border-bottom: none;
  }
</style>

---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import NewsletterForm from '../../components/NewsletterForm.astro';
import { getPublishedPosts, getPostDate } from '../../lib/beehiiv';

// Fetch posts from Beehiiv
const beehiivPosts = await getPublishedPosts(20);

// Transform Beehiiv posts to our format
const posts = beehiivPosts.length > 0
  ? beehiivPosts.map((post) => ({
      title: post.title,
      description: post.subtitle || 'Read more on this topic...',
      date: getPostDate(post),
      category: post.content_tags?.[0] || 'field-notes',
      slug: post.slug,
      url: post.web_url,
    }))
  : [
      {
        title: "Momentum: Why Some Marketing Investments Compound",
        description: "In physics, momentum equals mass times velocity. In marketing, it's the force that makes good programs get better and bad ones get worse.",
        date: new Date('2025-01-10'),
        category: 'physics',
        slug: 'momentum-marketing-investments',
      },
      {
        title: "The Friction Problem Nobody Talks About",
        description: "Every point of friction in your funnel isn't just losing you leadsâ€”it's training the market that you're hard to work with.",
        date: new Date('2025-01-05'),
        category: 'field-notes',
        slug: 'friction-problem',
      },
      {
        title: "Inflection Points: When to Pour Fuel on the Fire",
        description: "The difference between growth-stage success and failure often comes down to recognizing the moment when your marketing engine is ready to scale.",
        date: new Date('2024-12-28'),
        category: 'playbook',
        slug: 'inflection-points',
      },
    ];
---

<BaseLayout
  title="Writing"
  description="Observations on B2B SaaS marketing, demand generation, and the physics of growth."
>

  <!-- Hero -->
  <section class="section">
    <div class="container-narrow">
      <p class="section-label">Writing</p>
      <h1 class="text-display-lg mb-6" data-animate-hero>Thinking Out Loud</h1>
      <p class="text-body-lg text-gray-600 max-w-prose" data-animate-hero-sub>
        Observations on B2B SaaS marketing, demand generation, and the physics of growth.
      </p>
    </div>
  </section>

  <!-- Post List -->
  <section class="section-sm border-t border-gray-200">
    <div class="container-narrow">
      <div class="space-y-6" data-animate-stagger="0.06">
        {posts.map((post) => (
          <PostCard
            title={post.title}
            description={post.description}
            date={post.date}
            category={post.category}
            slug={post.slug}
            url={post.url}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Newsletter -->
  <NewsletterForm
    variant="default"
    heading="Never miss an update"
    description="Get new posts delivered to your inbox. No spam, just thinking about demand generation and B2B SaaS growth."
  />

</BaseLayout>
